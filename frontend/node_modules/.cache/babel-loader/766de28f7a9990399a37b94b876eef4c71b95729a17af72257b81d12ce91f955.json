{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/xampp/htdocs/ecommerce/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{forwardRef,useImperativeHandle,useRef,useContext,useState}from'react';import{createPortal}from'react-dom';import{gql,useMutation}from'@apollo/client';import{ToastContainer,toast}from'react-toastify';import Cart from'./Cart';import{CartContext}from'../store/shopping-cart-context';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CREATE_ORDER=gql(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  mutation CreateOrder($input: OrderInput!) {\\n    createOrder(input: $input) {\\n      id\\n      total\\n      items {\\n        id\\n        product_id\\n        quantity\\n        price\\n        attributes {\\n          id\\n          attribute_id\\n        }\\n      }\\n    }\\n  }\\n\"])));const CartModal=/*#__PURE__*/forwardRef(function Modal(_,ref){const modalRef=useRef();const[isOpen,setIsOpen]=useState(false);const{items,clearCart}=useContext(CartContext);const[createOrder,{loading,error}]=useMutation(CREATE_ORDER,{onCompleted:data=>{console.log('Order created:',data);clearCart();setIsOpen(false);toast.success(\"Order created!\",{position:\"top-center\",autoClose:3000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,progress:undefined});}});useImperativeHandle(ref,()=>({open:()=>setIsOpen(true),close:()=>setIsOpen(false)}));const handlePlaceOrder=()=>{const orderInput={total:items.reduce((acc,item)=>acc+item.price.amount*item.quantity,0),items:items.map(item=>({product_id:item.id,quantity:item.quantity,price:item.price.amount,attributes:item.selectedAttributes?Object.entries(item.selectedAttributes).map(_ref=>{let[key,value]=_ref;return{attribute_id:value};}):[]}))};createOrder({variables:{input:orderInput}});};if(!isOpen){return null;}return/*#__PURE__*/createPortal(/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-backdrop\",onClick:()=>setIsOpen(false)}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",ref:modalRef,children:[/*#__PURE__*/_jsx(Cart,{}),/*#__PURE__*/_jsxs(\"div\",{id:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{disabled:items.length<1||loading,className:\"place-order-button\",onClick:handlePlaceOrder,children:loading?'Placing order...':'Place order'}),error&&/*#__PURE__*/_jsxs(\"p\",{className:\"error\",children:[\"Error placing order: \",error.message]})]})]})]}),document.getElementById('modal-root'));});export default CartModal;","map":{"version":3,"names":["forwardRef","useImperativeHandle","useRef","useContext","useState","createPortal","gql","useMutation","ToastContainer","toast","Cart","CartContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CREATE_ORDER","_templateObject","_taggedTemplateLiteral","CartModal","Modal","_","ref","modalRef","isOpen","setIsOpen","items","clearCart","createOrder","loading","error","onCompleted","data","console","log","success","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","open","close","handlePlaceOrder","orderInput","total","reduce","acc","item","price","amount","quantity","map","product_id","id","attributes","selectedAttributes","Object","entries","_ref","key","value","attribute_id","variables","input","children","className","onClick","disabled","length","message","document","getElementById"],"sources":["C:/xampp/htdocs/ecommerce/frontend/src/components/CartModal.js"],"sourcesContent":["import { forwardRef, useImperativeHandle, useRef, useContext, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { gql, useMutation } from '@apollo/client';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport Cart from './Cart';\r\nimport { CartContext } from '../store/shopping-cart-context';\r\n\r\nconst CREATE_ORDER = gql`\r\n  mutation CreateOrder($input: OrderInput!) {\r\n    createOrder(input: $input) {\r\n      id\r\n      total\r\n      items {\r\n        id\r\n        product_id\r\n        quantity\r\n        price\r\n        attributes {\r\n          id\r\n          attribute_id\r\n        }\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nconst CartModal = forwardRef(function Modal(_, ref) {\r\n  const modalRef = useRef();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const { items, clearCart } = useContext(CartContext);\r\n\r\n  const [createOrder, { loading, error }] = useMutation(CREATE_ORDER, {\r\n    onCompleted: (data) => {\r\n      console.log('Order created:', data);\r\n      clearCart();\r\n      setIsOpen(false);\r\n      toast.success(\"Order created!\", {\r\n        position: \"top-center\",\r\n        autoClose: 3000,\r\n        hideProgressBar: false,\r\n        closeOnClick: true,\r\n        pauseOnHover: true,\r\n        draggable: true,\r\n        progress: undefined,\r\n      });\r\n    },\r\n  });\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    open: () => setIsOpen(true),\r\n    close: () => setIsOpen(false),\r\n  }));\r\n\r\n  const handlePlaceOrder = () => {\r\n    const orderInput = {\r\n      total: items.reduce((acc, item) => acc + item.price.amount * item.quantity, 0),\r\n      items: items.map(item => ({\r\n        product_id: item.id,\r\n        quantity: item.quantity,\r\n        price: item.price.amount,\r\n        attributes: item.selectedAttributes ? Object.entries(item.selectedAttributes).map(([key, value]) => ({\r\n          attribute_id: value\r\n        })) : [],\r\n      })),\r\n    };\r\n  \r\n    createOrder({ variables: { input: orderInput } });\r\n  };\r\n  \r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return createPortal(\r\n    <>\r\n      <div className=\"modal-backdrop\" onClick={() => setIsOpen(false)} />\r\n      <div className=\"modal\" ref={modalRef}>\r\n        <Cart />\r\n        <div id=\"modal-actions\">\r\n          <button\r\n            disabled={items.length < 1 || loading}\r\n            className=\"place-order-button\"\r\n            onClick={handlePlaceOrder}\r\n          >\r\n            {loading ? 'Placing order...' : 'Place order'}\r\n          </button>\r\n          {error && <p className=\"error\">Error placing order: {error.message}</p>}\r\n        </div>\r\n      </div>\r\n    </>,\r\n    document.getElementById('modal-root')\r\n  );\r\n});\r\n\r\nexport default CartModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}